{% extends 'triangle/base_template.html' %}
	{% block content %}
		{% load static %}
		<script>
			var csrftoken = Cookies.get("csrftoken");
			function csrfSafeMethod(method) {
				return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
			}
			
			$.ajaxSetup( {
				beforeSend: function(xhr, settings) {
					if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
						xhr.setRequestHeader("X-CSRFToken", csrftoken);
					}
				}
			});
			$(document).ready(function() {
				{% block domready %}
					$('.like').click(function(e){
					e.preventDefault();
					$.post('{% url "triangle:like" %}',
					{
						post_id: $(this).data('id'),
						action: $(this).data('action')
					},
					function(data){
					
					if (data['status'] == 'ok')
					{
					var previous_action = $('.like').data('action');
          // toggle data-action
					$('.like').data('action', previous_action == 'like' ? 
					'unlike' : 'like');
          // toggle link text
					$('.like').text(previous_action == 'like' ? 'Unlike' : 
					'Like');

          // update total likes
					var previous_likes = parseInt($('span.count .total').text());
					$('span.count .total').text(previous_action == 'like' ? 
					previous_likes + 1 : previous_likes - 1);
					
					}
				}
				);
				});
			{% endblock %}
			});
		</script>
</head>
<body>
	<div class="container" id="post-detail">
		<div class="post">
			<div class="user-details">
				<li class="user-photo"><a href="{% url "triangle:profile_detail" post.user.id %}"><img class="profile-photo" src="{{ profile.photo.url }}" alt="Profile Photo"></a></li>
				<li class="post-user"><a href="{% url "triangle:profile_detail" post.user.id %}"><h2>{{ post.user.username }}</h2></a></li>
			</div>
			<p class="post-content">{{ post.post_content }}</p>
			<p>{{ post.published }}</p>
			
			<div class="comment-div">
				<ul>
					{% for comment in post.comment_set.all %}
						<li class="follow-container">
							<img class="profile-photo" src="{{ comment.user.profile.photo.url }}">
							<a href="{% url "triangle:profile_detail" comment.user.id %}"><h3>{{ comment.user }}</h3></a>
							<p>{{ comment.comment_text }}<p>
						</li>
					{% endfor %}
				</ul>
			</div>
		</div>
		
		<div class="like-div">
			{% with total_likes=post.users_like.count users_like=post.users_like.all %}
			<span class="count">
				<span class="total">{{ total_likes }}</span>
				like{{ total_likes|pluralize }}
			</span>
			<button href="#" data-id="{{ post.id }}" data-action="{% if request.user in users_like %}un{% endif %}like" class="like button">
			{% if request.user not in users_like %}
				Like
			{% else %}
				Unlike
			{% endif %}
			</button>
	{% endwith %}
		</div>
		<div class="comment-form">
			<form enctype="multipart/form-data" method="POST">
				{% csrf_token %}
				{{ comment_form.as_p }}
				<button href="#" type="submit" name="" value="Comment">Comment</button>
			</form>
		</div>
	</div>
</body
{% endblock content %}
